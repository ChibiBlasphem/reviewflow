{"version":3,"file":"index-node10-dev.cjs.js","sources":["../src/orgsConfigs/ornikar.ts","../src/orgsConfigs/christophehurpeau.ts","../src/orgsConfigs/index.ts","../src/pr-handlers/actions/utils/prOptions.ts","../src/pr-handlers/actions/utils/parseBody.ts","../src/pr-handlers/actions/autoMergeIfPossible.ts","../src/context/initRepoLabels.ts","../src/context/utils.ts","../src/context/initTeamSlack.ts","../src/context/orgContext.ts","../src/context/repoContext.ts","../src/pr-handlers/utils.ts","../src/pr-handlers/actions/autoAssignPRToCreator.ts","../src/pr-handlers/actions/utils/cleanTitle.ts","../src/pr-handlers/actions/utils/updateBody.ts","../src/pr-handlers/actions/editOpenedPR.ts","../src/pr-handlers/actions/updateStatusCheckFromLabels.ts","../src/pr-handlers/actions/updateReviewStatus.ts","../src/pr-handlers/actions/autoApproveAndAutoMerge.ts","../src/pr-handlers/opened.ts","../src/pr-handlers/closed.ts","../src/pr-handlers/reviewRequested.ts","../src/pr-handlers/reviewRequestRemoved.ts","../src/pr-handlers/reviewSubmitted.ts","../src/pr-handlers/reviewDismissed.ts","../src/pr-handlers/synchronize.ts","../src/pr-handlers/edited.ts","../src/pr-handlers/actions/updatePrBody.ts","../src/pr-handlers/labelsChanged.ts","../src/pr-handlers/checkrunCompleted.ts","../src/pr-handlers/checksuiteCompleted.ts","../src/pr-handlers/status.ts","../src/index.ts"],"sourcesContent":["import { Config } from './types';\n\nconst config: Config<'dev' | 'design', 'frontends' | 'backends'> = {\n  slackToken: process.env.ORNIKAR_SLACK_TOKEN,\n  autoAssignToCreator: true,\n  trimTitle: true,\n  requiresReviewRequest: true,\n  prDefaultOptions: {\n    featureBranch: false,\n    autoMergeWithSkipCi: false,\n    autoMerge: false,\n    deleteAfterMerge: true,\n  },\n  parsePR: {\n    title: [\n      {\n        regExp:\n          // eslint-disable-next-line unicorn/no-unsafe-regex\n          /^(revert: )?(build|chore|ci|docs|feat|fix|perf|refactor|style|test)(\\(([a-z\\-/]*)\\))?:\\s/,\n        error: {\n          title: 'Title does not match commitlint conventional',\n          summary:\n            'https://github.com/marionebl/commitlint/tree/master/%40commitlint/config-conventional',\n        },\n      },\n      {\n        bot: false,\n        regExp: /\\s(ONK-(\\d+)|\\[no issue])$/,\n        error: {\n          title: 'Title does not have JIRA issue',\n          summary: 'The PR title should end with ONK-0000, or [no issue]',\n        },\n        status: 'jira-issue',\n        statusInfoFromMatch: (match) => {\n          const issue = match[1];\n          if (issue === '[no issue]') {\n            return {\n              title: 'No issue',\n              summary: '',\n            };\n          }\n          return {\n            inBody: true,\n            url: `https://ornikar.atlassian.net/browse/${issue}`,\n            title: `JIRA issue: ${issue}`,\n            summary: `[${issue}](https://ornikar.atlassian.net/browse/${issue})`,\n          };\n        },\n      },\n    ],\n  },\n\n  groups: {\n    dev: {\n      /* back */\n      abarreir: `alexandre${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      arthurflachs: `arthur${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      rigma: `romain${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      damienorny: `damien.orny${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      'Thierry-girod': `thierry${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      darame07: `kevin${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      Pixy: `pierre-alexis${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      /* front */\n      christophehurpeau: `christophe${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      HugoGarrido: `hugo${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      LentnerStefan: `stefan${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      CorentinAndre: `corentin${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      Mxime: `maxime${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      tilap: `julien.lavinh${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      vlbr: `valerian${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n    },\n    design: {\n      jperriere: `julien${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n      CoralineColasse: `coraline${process.env.ORNIKAR_EMAIL_DOMAIN}`,\n    },\n  },\n\n  teams: {\n    backends: {\n      logins: [\n        'abarreir',\n        'arthurflachs',\n        'rigma',\n        'damienorny',\n        'Thierry-girod',\n        'darame07',\n        'Pixy',\n      ],\n      labels: ['teams/backend'],\n    },\n\n    frontends: {\n      logins: [\n        'christophehurpeau',\n        'HugoGarrido',\n        'LentnerStefan',\n        'CorentinAndre',\n        'Mxime',\n        'tilap',\n        'vlbr',\n      ],\n      labels: ['teams/frontend'],\n    },\n  },\n\n  waitForGroups: {\n    dev: [],\n    design: ['dev'],\n  },\n  labels: {\n    list: {\n      // /* ci */\n      // 'ci/in-progress': { name: ':green_heart: ci/in-progress', color: '#0052cc' },\n      // 'ci/fail': { name: ':green_heart: ci/fail', color: '#e11d21' },\n      // 'ci/passed': { name: ':green_heart: ci/passed', color: '#86f9b4' },\n\n      /* code */\n      'code/needs-review': {\n        name: ':ok_hand: code/needs-review',\n        color: '#FFC44C',\n      },\n      'code/review-requested': {\n        name: ':ok_hand: code/review-requested',\n        color: '#DAE1E6',\n      },\n      'code/changes-requested': {\n        name: ':ok_hand: code/changes-requested',\n        color: '#e11d21',\n      },\n      'code/approved': {\n        name: ':ok_hand: code/approved',\n        color: '#64DD17',\n      },\n\n      /* design */\n      'design/needs-review': {\n        name: ':art: design/needs-review',\n        color: '#FFC44C',\n      },\n      'design/review-requested': {\n        name: ':art: design/review-requested',\n        color: '#DAE1E6',\n      },\n      'design/changes-requested': {\n        name: ':art: design/changes-requested',\n        color: '#e11d21',\n      },\n      'design/approved': {\n        name: ':art: design/approved',\n        color: '#64DD17',\n      },\n\n      /* teams */\n\n      'teams/backend': {\n        name: 'backend',\n        color: '#6ad8cb',\n      },\n      'teams/frontend': {\n        name: 'frontend',\n        color: '#8a5abc',\n      },\n\n      /* auto merge */\n      'merge/automerge': {\n        name: ':soon: automerge',\n        color: '#64DD17',\n      },\n\n      /* feature-branch */\n      'feature-branch': {\n        name: 'feature-branch',\n        color: '#7FCEFF',\n      },\n    },\n\n    review: {\n      ci: {\n        inProgress: 'ci/in-progress',\n        succeeded: 'ci/success',\n        failed: 'ci/fail',\n      },\n      dev: {\n        needsReview: 'code/needs-review',\n        requested: 'code/review-requested',\n        changesRequested: 'code/changes-requested',\n        approved: 'code/approved',\n      },\n      design: {\n        needsReview: 'design/needs-review',\n        requested: 'design/review-requested',\n        changesRequested: 'design/changes-requested',\n        approved: 'design/approved',\n      },\n    },\n  },\n};\n\nexport default config;\n","import { Config } from './types';\n\nconst config: Config<'dev', never> = {\n  autoAssignToCreator: true,\n  trimTitle: true,\n  requiresReviewRequest: false,\n  prDefaultOptions: {\n    featureBranch: false,\n    autoMergeWithSkipCi: false,\n    autoMerge: false,\n    deleteAfterMerge: true,\n  },\n  parsePR: {\n    title: [\n      {\n        regExp:\n          // eslint-disable-next-line unicorn/no-unsafe-regex\n          /^(revert: )?(build|chore|ci|docs|feat|fix|perf|refactor|style|test)(\\(([a-z\\-/]*)\\))?:\\s/,\n        error: {\n          title: 'Title does not match commitlint conventional',\n          summary:\n            'https://github.com/marionebl/commitlint/tree/master/%40commitlint/config-conventional',\n        },\n      },\n    ],\n  },\n  groups: {\n    dev: {\n      christophehurpeau: 'christophe@hurpeau.com',\n      'chris-reviewflow': 'christophe.hurpeau+reviewflow@gmail.com',\n      tilap: 'jlavinh@gmail.com',\n    },\n  },\n  waitForGroups: {\n    dev: [],\n  },\n  teams: {},\n  labels: {\n    list: {\n      // /* ci */\n      // 'ci/in-progress': { name: ':green_heart: ci/in-progress', color: '#0052cc' },\n      // 'ci/fail': { name: ':green_heart: ci/fail', color: '#e11d21' },\n      // 'ci/passed': { name: ':green_heart: ci/passed', color: '#86f9b4' },\n\n      /* code */\n      'code/needs-review': {\n        name: ':ok_hand: code/needs-review',\n        color: '#FFD57F',\n      },\n      'code/review-requested': {\n        name: ':ok_hand: code/review-requested',\n        color: '#B2E1FF',\n      },\n      'code/changes-requested': {\n        name: ':ok_hand: code/changes-requested',\n        color: '#e11d21',\n      },\n      'code/approved': {\n        name: ':ok_hand: code/approved',\n        color: '#64DD17',\n      },\n\n      /* auto merge */\n      'merge/automerge': {\n        name: ':soon: automerge',\n        color: '#64DD17',\n      },\n\n      /* feature-branch */\n      'feature-branch': {\n        name: 'feature-branch',\n        color: '#7FCEFF',\n      },\n    },\n\n    review: {\n      ci: {\n        inProgress: 'ci/in-progress',\n        succeeded: 'ci/success',\n        failed: 'ci/fail',\n      },\n      dev: {\n        needsReview: 'code/needs-review',\n        requested: 'code/review-requested',\n        changesRequested: 'code/changes-requested',\n        approved: 'code/approved',\n      },\n    },\n  },\n};\n\nexport default config;\n","import { Config as ConfigType } from './types';\nimport ornikar from './ornikar';\nimport christophehurpeau from './christophehurpeau';\n\nexport type Config<\n  GroupNames extends string = any,\n  TeamNames extends string = any\n> = ConfigType<GroupNames, TeamNames>;\n\nexport const orgsConfigs: { [owner: string]: Config } = {\n  ornikar,\n  christophehurpeau,\n};\n\n// flat requires node 11\n// export const getMembers = <GroupNames extends string = any>(\n//   groups: Record<GroupNames, Group>,\n// ): string[] => {\n//   return Object.values(groups).flat(1);\n// };\n","export type Options =\n  | 'featureBranch'\n  | 'autoMergeWithSkipCi'\n  | 'autoMerge'\n  | 'deleteAfterMerge';\n\nexport const options: Options[] = [\n  'featureBranch',\n  'autoMergeWithSkipCi',\n  'autoMerge',\n  'deleteAfterMerge',\n];\nexport const optionsRegexps: { name: Options; regexp: RegExp }[] = options.map(\n  (option) => ({\n    name: option,\n    regexp: new RegExp(`\\\\[([ xX]?)]\\\\s*<!-- reviewflow-${option} -->`),\n  }),\n);\n\nexport const optionsLabels: { name: Options; label: string }[] = [\n  { name: 'featureBranch', label: 'This PR is a feature branch' },\n  {\n    name: 'autoMergeWithSkipCi',\n    label: 'Auto merge with `[skip ci]`',\n  },\n  {\n    name: 'autoMerge',\n    label:\n      'Auto merge when this PR is ready and has no failed statuses. (Also has a queue per repo to prevent multiple useless \"Update branch\" triggers)',\n  },\n  {\n    name: 'deleteAfterMerge',\n    label: 'Automatic branch delete after this PR is merged',\n  },\n];\n","import { Options, optionsRegexps } from './prOptions';\n\nconst commentStart = '<!-- do not edit after this -->';\nconst commentEnd = \"<!-- end - don't add anything after this -->\";\n\nconst regexpCols = /^(.*)(<!---? do not edit after this -?-->(.*)<!---? end - don't add anything after this -?-->)(.*)$/is;\nconst regexpReviewflowCol = /^(\\s*<!---? do not edit after this -?--><\\/td><td [^>]*>)\\s*(.*)\\s*(<\\/td><\\/tr><\\/table>\\s*<!---? end - don't add anything after this -?-->)\\s*$/is;\n\nconst parseOptions = (\n  content: string,\n  defaultConfig: Record<Options, boolean>,\n): Record<Options, boolean> => {\n  return optionsRegexps.reduce(\n    (acc, { name, regexp }) => {\n      const match = regexp.exec(content);\n      acc[name] = !match\n        ? defaultConfig[name] || false\n        : match[1] === 'x' || match[1] === 'X';\n      return acc;\n    },\n    {} as any,\n  ) as Record<Options, boolean>;\n};\n\nexport const parseBody = (\n  description: string,\n  defaultConfig: Record<Options, boolean>,\n) => {\n  const match = regexpCols.exec(description);\n  if (!match) return null;\n  const [, content, reviewFlowCol, reviewflowContent, ending] = match;\n  const reviewFlowColMatch = regexpReviewflowCol.exec(reviewFlowCol);\n  if (!reviewFlowColMatch) {\n    return {\n      content,\n      ending,\n      reviewflowContentCol: reviewflowContent,\n      reviewflowContentColPrefix: commentStart,\n      reviewflowContentColSuffix: commentEnd,\n      options: parseOptions(reviewFlowCol, defaultConfig),\n    };\n  }\n  const [\n    ,\n    reviewflowContentColPrefix,\n    reviewflowContentCol,\n    reviewflowContentColSuffix,\n  ] = reviewFlowColMatch;\n\n  return {\n    content,\n    ending,\n    reviewflowContentCol,\n    reviewflowContentColPrefix,\n    reviewflowContentColSuffix,\n    options: parseOptions(reviewflowContentCol, defaultConfig),\n  };\n};\n","/* eslint-disable max-lines */\nimport { Context } from 'probot';\n// eslint-disable-next-line import/no-cycle\nimport { RepoContext } from '../../context/repoContext';\nimport { LabelResponse } from '../../context/initRepoLabels';\nimport { parseBody } from './utils/parseBody';\n\nconst hasFailedStatusOrChecks = async (\n  context: Context<any>,\n  repoContext: RepoContext,\n  pr: any,\n) => {\n  const checks = await context.github.checks.listForRef(\n    context.repo({\n      ref: pr.head.sha,\n      per_page: 100,\n    }),\n  );\n\n  const failedChecks = checks.data.check_runs.filter(\n    (check) => check.conclusion === 'failure',\n  );\n\n  if (failedChecks.length !== 0) {\n    context.log.info(`automerge not possible: failed check pr ${pr.id}`, {\n      checks: failedChecks.map((check) => check.name),\n    });\n    return true;\n  }\n\n  const combinedStatus = await context.github.repos.getCombinedStatusForRef(\n    context.repo({\n      ref: pr.head.sha,\n      per_page: 100,\n    }),\n  );\n\n  if (combinedStatus.data.state === 'failure') {\n    const failedStatuses = combinedStatus.data.statuses.filter(\n      (status) => status.state === 'failure' || status.state === 'error',\n    );\n\n    context.log.info(`automerge not possible: failed status pr ${pr.id}`, {\n      statuses: failedStatuses.map((status) => status.context),\n    });\n\n    return true;\n  }\n\n  return false;\n};\n\nexport const autoMergeIfPossible = async (\n  context: Context<any>,\n  repoContext: RepoContext,\n  pr: any = context.payload.pull_request,\n  prLabels: LabelResponse[] = pr.labels,\n): Promise<boolean> => {\n  const autoMergeLabel = repoContext.labels['merge/automerge'];\n  if (!autoMergeLabel) return false;\n\n  const createMergeLockPrFromPr = () => ({\n    id: pr.id,\n    number: pr.number,\n    branch: pr.head.ref,\n  });\n\n  if (!prLabels.find((l): boolean => l.id === autoMergeLabel.id)) {\n    context.log.debug('automerge not possible: no label', {\n      prId: pr.id,\n      prNumber: pr.number,\n    });\n    repoContext.removePrFromAutomergeQueue(context, pr.number);\n    return false;\n  }\n\n  if (pr.state !== 'open') {\n    context.log.debug('automerge not possible: pr is not opened', {\n      prId: pr.id,\n      prNumber: pr.number,\n    });\n    repoContext.removePrFromAutomergeQueue(context, pr.number);\n  }\n\n  if (\n    repoContext.hasNeedsReview(prLabels) ||\n    repoContext.hasRequestedReview(prLabels)\n  ) {\n    context.log.debug('automerge not possible: blocking labels', {\n      prId: pr.id,\n      prNumber: pr.number,\n    });\n    repoContext.removePrFromAutomergeQueue(context, pr.number);\n    return false;\n  }\n\n  const lockedPr = repoContext.getMergeLockedPr();\n  if (lockedPr && lockedPr.number !== pr.number) {\n    context.log.info('automerge not possible: locked pr', {\n      prId: pr.id,\n      prNumber: pr.number,\n    });\n    repoContext.pushAutomergeQueue(createMergeLockPrFromPr());\n    return false;\n  }\n\n  repoContext.addMergeLockPr(createMergeLockPrFromPr());\n\n  if (pr.mergeable === undefined) {\n    const prResult = await context.github.pulls.get(\n      context.repo({\n        pull_number: pr.number,\n      }),\n    );\n    pr = prResult.data;\n  }\n\n  if (pr.merged) {\n    repoContext.removePrFromAutomergeQueue(context, pr.number);\n    context.log.info('automerge not possible: already merged pr', {\n      prId: pr.id,\n      prNumber: pr.number,\n    });\n    return false;\n  }\n\n  context.log.info(\n    `automerge?: ${pr.id}, #${pr.number}, mergeable=${pr.mergeable} state=${\n      pr.mergeable_state\n    }`,\n  );\n\n  // https://github.com/octokit/octokit.net/issues/1763\n  if (\n    !(\n      pr.mergeable_state === 'clean' ||\n      pr.mergeable_state === 'has_hooks' ||\n      pr.mergeable_state === 'unstable'\n    )\n  ) {\n    if (!pr.mergeable_state || pr.mergeable_state === 'unknown') {\n      context.log.info(`automerge not possible: rescheduling ${pr.id}`);\n      // GitHub is determining whether the pull request is mergeable\n      repoContext.reschedule(context, createMergeLockPrFromPr());\n      return false;\n    }\n\n    if (pr.head.ref.startsWith('renovate/')) {\n      if (pr.mergeable_state === 'behind' || pr.mergeable_state === 'dirty') {\n        context.log.info(\n          `automerge not possible: rebase renovate branch pr ${pr.id}`,\n        );\n        // TODO check if has commits not made by renovate https://github.com/ornikar/shared-configs/pull/47#issuecomment-445767120\n\n        await context.github.issues.update(\n          context.repo({\n            number: pr.number,\n            body: pr.body.replace(\n              '[ ] <!-- renovate-rebase -->',\n              '[x] <!-- renovate-rebase -->',\n            ),\n          }),\n        );\n        return false;\n      }\n\n      if (await hasFailedStatusOrChecks(context, repoContext, pr)) {\n        repoContext.removePrFromAutomergeQueue(context, pr.number);\n        return false;\n      } else if (pr.mergeable_state === 'blocked') {\n        // waiting for reschedule in status (pr-handler/status.ts)\n        return false;\n      }\n\n      context.log.info(\n        `automerge not possible: renovate with mergeable_state=${\n          pr.mergeable_state\n        }`,\n      );\n      return false;\n    }\n\n    if (pr.mergeable_state === 'blocked') {\n      if (await hasFailedStatusOrChecks(context, repoContext, pr)) {\n        repoContext.removePrFromAutomergeQueue(context, pr.number);\n        return false;\n      } else {\n        // waiting for reschedule in status (pr-handler/status.ts)\n        return false;\n      }\n    }\n\n    if (pr.mergeable_state === 'behind') {\n      context.log.info('automerge not possible: update branch', {\n        head: pr.head.ref,\n        base: pr.base.ref,\n      });\n\n      await context.github.repos.merge({\n        owner: pr.head.repo.owner.login,\n        repo: pr.head.repo.name,\n        head: pr.base.ref,\n        base: pr.head.ref,\n      });\n\n      return false;\n    }\n\n    repoContext.removePrFromAutomergeQueue(context, pr.number);\n    context.log.info(\n      `automerge not possible: not mergeable mergeable_state=${\n        pr.mergeable_state\n      }`,\n    );\n    return false;\n  }\n\n  try {\n    context.log.info(`automerge pr #${pr.number}`);\n\n    const parsedBody = parseBody(pr.body, repoContext.config.prDefaultOptions);\n    const options =\n      (parsedBody && parsedBody.options) || repoContext.config.prDefaultOptions;\n\n    const mergeResult = await context.github.pulls.merge({\n      merge_method: options.featureBranch ? 'merge' : 'squash',\n      owner: pr.head.repo.owner.login,\n      repo: pr.head.repo.name,\n      pull_number: pr.number,\n      commit_title: `${pr.title}${\n        options.autoMergeWithSkipCi ? ' [skip ci]' : ''\n      } (#${pr.number})`,\n      commit_message: '', // TODO add BC\n    });\n    context.log.debug('merge result:', mergeResult.data);\n    repoContext.removePrFromAutomergeQueue(context, pr.number);\n    return Boolean(mergeResult.data.merged);\n  } catch (err) {\n    context.log.info('could not merge:', err.message);\n    repoContext.reschedule(context, createMergeLockPrFromPr());\n    return false;\n  }\n};\n","import { Context } from 'probot';\nimport { Config } from '../orgsConfigs';\n\nexport interface LabelResponse {\n  id: number;\n  node_id: string;\n  url: string;\n  name: string;\n  description: string;\n  color: string;\n  default: boolean;\n}\n\nexport interface Labels {\n  [key: string]: LabelResponse;\n}\n\nexport const initRepoLabels = async <GroupNames extends string>(\n  context: Context<any>,\n  config: Config<GroupNames>,\n): Promise<Labels> => {\n  const { data: labels } = await context.github.issues.listLabelsForRepo(\n    context.repo({ per_page: 100 }),\n  );\n  const finalLabels: Record<string, LabelResponse> = {};\n\n  for (const [labelKey, labelConfig] of Object.entries(config.labels.list)) {\n    const labelColor = labelConfig.color.slice(1);\n    const description = `Generated by review-flow for ${labelKey}`;\n\n    let existingLabel = labels.find((label) => label.name === labelConfig.name);\n    if (!existingLabel) {\n      existingLabel = labels.find((label) => label.description === description);\n    }\n    if (!existingLabel) {\n      if (labelKey === 'design/needs-review') {\n        existingLabel = labels.find(\n          (label) => label.name === 'needs-design-review',\n        );\n      }\n      if (labelKey === 'design/approved') {\n        existingLabel = labels.find(\n          (label) => label.name === 'design-reviewed',\n        );\n      }\n    }\n\n    if (!existingLabel) {\n      const result = await context.github.issues.createLabel(\n        context.repo({\n          name: labelConfig.name,\n          color: labelColor,\n          description,\n        }),\n      );\n      finalLabels[labelKey] = result.data;\n    } else if (\n      existingLabel.name !== labelConfig.name ||\n      existingLabel.color !== labelColor // ||\n      // TODO: description is never updated\n      // existingLabel.description !== description\n    ) {\n      context.log.info('Needs to update label', {\n        current_name: existingLabel.name,\n        name: existingLabel.name !== labelConfig.name && labelConfig.name,\n        color: existingLabel.color !== labelColor && labelColor,\n        description: existingLabel.description !== description && description,\n      });\n\n      const result = await context.github.issues.updateLabel(\n        context.repo({\n          current_name: existingLabel.name,\n          name: labelConfig.name,\n          color: labelColor,\n          description,\n        }),\n      );\n      finalLabels[labelKey] = result.data;\n    } else {\n      finalLabels[labelKey] = existingLabel;\n    }\n  }\n\n  return finalLabels;\n};\n","export const getKeys = <T extends {}>(o: T): (keyof T)[] =>\n  Object.keys(o) as (keyof T)[];\n","import { WebClient } from '@slack/web-api';\nimport { Context } from 'probot';\nimport { Config } from '../orgsConfigs';\nimport { getKeys } from './utils';\n\nexport interface TeamSlack {\n  mention: (githubLogin: string) => string;\n  postMessage: (githubLogin: string, text: string) => Promise<void>;\n}\n\nconst ExcludesFalsy = (Boolean as any) as <T>(\n  x: T | false | null | undefined,\n) => x is T;\n\nexport const initTeamSlack = async <GroupNames extends string>(\n  context: Context<any>,\n  config: Config<GroupNames>,\n): Promise<TeamSlack> => {\n  if (!config.slackToken) {\n    return {\n      mention: (githubLogin: string) => '',\n      postMessage: (githubLogin: string, text: string) => Promise.resolve(),\n    };\n  }\n\n  const githubLoginToSlackEmail = getKeys(config.groups).reduce<{\n    [login: string]: string;\n  }>((acc, groupName) => {\n    Object.assign(acc, config.groups[groupName]);\n    return acc;\n  }, {});\n\n  const slackClient = new WebClient(config.slackToken);\n  const allUsers: any = await slackClient.users.list({ limit: 200 });\n  const members: [string, { member: any; im: any }][] = Object.values(\n    githubLoginToSlackEmail,\n  )\n    .map((email) => {\n      const member = allUsers.members.find(\n        (user: any) => user.profile.email === email,\n      );\n      if (!member) {\n        console.warn(`Could not find user ${email}`);\n        return;\n      }\n      return [email, { member, im: undefined }] as [\n        string,\n        { member: any; im: any }\n      ];\n    })\n    .filter(ExcludesFalsy);\n\n  for (const [, user] of members) {\n    try {\n      const im: any = await slackClient.im.open({ user: user.member.id });\n      user.im = im.channel;\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  const membersMap = new Map(members);\n\n  const getUserFromGithubLogin = (githubLogin: string) => {\n    const email = githubLoginToSlackEmail[githubLogin];\n    if (!email) return null;\n    return membersMap.get(email);\n  };\n\n  return {\n    mention: (githubLogin: string) => {\n      const user = getUserFromGithubLogin(githubLogin);\n      if (!user) return githubLogin;\n      return `<@${user.member.id}>`;\n    },\n    postMessage: async (githubLogin: string, text: string) => {\n      context.log.info('send slack', { githubLogin, text });\n      if (process.env.DRY_RUN) return;\n\n      const user = getUserFromGithubLogin(githubLogin);\n      if (!user || !user.im) return;\n      await slackClient.chat.postMessage({\n        channel: user.im.id,\n        text,\n      });\n    },\n  };\n};\n","import { Context } from 'probot';\nimport { Config } from '../orgsConfigs';\nimport { initTeamSlack, TeamSlack } from './initTeamSlack';\nimport { getKeys } from './utils';\n\nexport interface OrgContext<\n  GroupNames extends string = any,\n  TeamNames extends string = any\n> {\n  config: Config<GroupNames, TeamNames>;\n  slack: TeamSlack;\n  getReviewerGroup: (githubLogin: string) => string | undefined;\n  getReviewerGroups: (githubLogins: string[]) => string[];\n  getTeamsForLogin: (githubLogin: string) => TeamNames[];\n  reviewShouldWait: (\n    reviewerGroup: GroupNames | undefined,\n    requestedReviewers: any[],\n    {\n      includesReviewerGroup,\n      includesWaitForGroups,\n    }: { includesReviewerGroup?: boolean; includesWaitForGroups?: boolean },\n  ) => boolean;\n}\nconst ExcludesFalsy = (Boolean as any) as <T>(\n  x: T | false | null | undefined,\n) => x is T;\n\nconst initTeamContext = async (\n  context: Context<any>,\n  config: Config,\n): Promise<OrgContext> => {\n  const slackPromise = initTeamSlack(context, config);\n\n  const githubLoginToGroup = new Map<string, string>();\n  getKeys(config.groups).forEach((groupName) => {\n    Object.keys(config.groups[groupName]).forEach((login) => {\n      githubLoginToGroup.set(login, groupName);\n    });\n  });\n\n  const githubLoginToTeams = new Map<string, string[]>();\n  getKeys(config.teams || {}).forEach((teamName) => {\n    (config.teams as NonNullable<typeof config.teams>)[teamName].logins.forEach(\n      (login) => {\n        const teams = githubLoginToTeams.get(login);\n        if (teams) {\n          teams.push(teamName);\n        } else {\n          githubLoginToTeams.set(login, [teamName]);\n        }\n      },\n    );\n  });\n\n  const getReviewerGroups = (githubLogins: string[]) => [\n    ...new Set(\n      githubLogins\n        .map((githubLogin) => githubLoginToGroup.get(githubLogin))\n        .filter(Boolean),\n    ),\n  ];\n\n  return {\n    config,\n    getReviewerGroup: (githubLogin) => githubLoginToGroup.get(githubLogin),\n    getReviewerGroups: (githubLogins) => [\n      ...new Set(\n        githubLogins\n          .map((githubLogin) => githubLoginToGroup.get(githubLogin))\n          .filter(ExcludesFalsy),\n      ),\n    ],\n\n    getTeamsForLogin: (githubLogin) =>\n      githubLoginToTeams.get(githubLogin) || [],\n\n    reviewShouldWait: (\n      reviewerGroup,\n      requestedReviewers,\n      { includesReviewerGroup, includesWaitForGroups },\n    ) => {\n      if (!reviewerGroup) return false;\n\n      const requestedReviewerGroups = getReviewerGroups(\n        requestedReviewers.map((request) => request.login),\n      );\n\n      // contains another request of a reviewer in the same group\n      if (\n        includesReviewerGroup &&\n        requestedReviewerGroups.includes(reviewerGroup)\n      ) {\n        return true;\n      }\n\n      // contains a request from a dependent group\n      if (config.waitForGroups && includesWaitForGroups) {\n        const waitForGroups = config.waitForGroups;\n        return requestedReviewerGroups.some((group) =>\n          waitForGroups[reviewerGroup].includes(group),\n        );\n      }\n\n      return false;\n    },\n\n    slack: await slackPromise,\n  };\n};\n\nconst orgContextsPromise = new Map();\nconst orgContexts = new Map();\n\nexport const obtainOrgContext = (\n  context: Context<any>,\n  config: Config,\n): Promise<OrgContext> => {\n  const owner = context.payload.repository.owner;\n\n  const existingTeamContext = orgContexts.get(owner.login);\n  if (existingTeamContext) return existingTeamContext;\n\n  const existingPromise = orgContextsPromise.get(owner.login);\n  if (existingPromise) return Promise.resolve(existingPromise);\n\n  const promise = initTeamContext(context, config);\n  orgContextsPromise.set(owner.login, promise);\n\n  return promise.then((orgContext) => {\n    orgContextsPromise.delete(owner.login);\n    orgContexts.set(owner.login, orgContext);\n    return orgContext;\n  });\n};\n","/* eslint-disable max-lines */\n\nimport { Lock } from 'lock';\nimport { Context } from 'probot';\nimport { orgsConfigs, Config } from '../orgsConfigs';\n// eslint-disable-next-line import/no-cycle\nimport { autoMergeIfPossible } from '../pr-handlers/actions/autoMergeIfPossible';\nimport { initRepoLabels, LabelResponse, Labels } from './initRepoLabels';\nimport { obtainOrgContext, OrgContext } from './orgContext';\n\nexport interface LockedMergePr {\n  id: number;\n  number: number;\n  branch: string;\n}\n\ninterface RepoContextWithoutTeamContext<GroupNames extends string> {\n  labels: Labels;\n  protectedLabelIds: readonly LabelResponse['id'][];\n\n  hasNeedsReview: (labels: LabelResponse[]) => boolean;\n  hasRequestedReview: (labels: LabelResponse[]) => boolean;\n  hasChangesRequestedReview: (labels: LabelResponse[]) => boolean;\n  hasApprovesReview: (labels: LabelResponse[]) => boolean;\n  getNeedsReviewGroupNames: (labels: LabelResponse[]) => GroupNames[];\n\n  lockPROrPRS(\n    prIdOrIds: string | string[],\n    callback: () => Promise<void> | void,\n  ): Promise<void>;\n\n  getMergeLockedPr(): LockedMergePr;\n  addMergeLockPr(pr: LockedMergePr): void;\n  removePrFromAutomergeQueue(context: Context<any>, prNumber: number): void;\n  reschedule(context: Context<any>, pr: LockedMergePr): void;\n  pushAutomergeQueue(pr: LockedMergePr): void;\n}\n\nconst ExcludesFalsy = (Boolean as any) as <T>(\n  x: T | false | null | undefined,\n) => x is T;\n\nexport type RepoContext<GroupNames extends string = any> = OrgContext<\n  GroupNames\n> &\n  RepoContextWithoutTeamContext<GroupNames>;\n\nasync function initRepoContext<GroupNames extends string>(\n  context: Context<any>,\n  config: Config<GroupNames>,\n): Promise<RepoContext<GroupNames>> {\n  const orgContext = await obtainOrgContext(context, config);\n  const repoContext = Object.create(orgContext);\n\n  const [labels] = await Promise.all([initRepoLabels(context, config)]);\n\n  const reviewGroupNames = Object.keys(config.groups) as GroupNames[];\n\n  const needsReviewLabelIds = reviewGroupNames\n    .map((key: GroupNames) => config.labels.review[key].needsReview)\n    .filter(Boolean)\n    .map((name) => labels[name].id);\n\n  const requestedReviewLabelIds = reviewGroupNames\n    .map((key) => config.labels.review[key].requested)\n    .filter(Boolean)\n    .map((name) => labels[name].id);\n\n  const changesRequestedLabelIds = reviewGroupNames\n    .map((key) => config.labels.review[key].changesRequested)\n    .filter(Boolean)\n    .map((name) => labels[name].id);\n\n  const approvedReviewLabelIds = reviewGroupNames\n    .map((key) => config.labels.review[key].approved)\n    .filter(Boolean)\n    .map((name) => labels[name].id);\n\n  const protectedLabelIds = [\n    ...requestedReviewLabelIds,\n    ...changesRequestedLabelIds,\n    ...approvedReviewLabelIds,\n  ];\n\n  const labelIdToGroupName = new Map<LabelResponse['id'], GroupNames>();\n  reviewGroupNames.forEach((key) => {\n    const reviewGroupLabels = config.labels.review[key] as any;\n    Object.keys(reviewGroupLabels).forEach((labelKey: string) => {\n      labelIdToGroupName.set(labels[reviewGroupLabels[labelKey]].id, key);\n    });\n  });\n\n  // const updateStatusCheck = (context, reviewGroup, statusInfo) => {};\n\n  const hasNeedsReview = (labels: LabelResponse[]) =>\n    labels.some((label) => needsReviewLabelIds.includes(label.id));\n  const hasRequestedReview = (labels: LabelResponse[]) =>\n    labels.some((label) => requestedReviewLabelIds.includes(label.id));\n  const hasChangesRequestedReview = (labels: LabelResponse[]) =>\n    labels.some((label) => changesRequestedLabelIds.includes(label.id));\n  const hasApprovesReview = (labels: LabelResponse[]) =>\n    labels.some((label) => approvedReviewLabelIds.includes(label.id));\n\n  const getNeedsReviewGroupNames = (labels: LabelResponse[]): GroupNames[] =>\n    labels\n      .filter((label) => needsReviewLabelIds.includes(label.id))\n      .map((label) => labelIdToGroupName.get(label.id))\n      .filter(ExcludesFalsy);\n\n  const lock = Lock();\n  let lockMergePr: LockedMergePr | undefined;\n  let automergeQueue: LockedMergePr[] = [];\n\n  const lockPROrPRS = (\n    prIdOrIds: string | string[],\n    callback: () => Promise<void> | void,\n  ): Promise<void> =>\n    new Promise((resolve, reject) => {\n      console.log('lock: try to lock pr', { prIdOrIds });\n      lock(prIdOrIds, async (createReleaseCallback) => {\n        const release = createReleaseCallback(() => {});\n        console.log('lock: lock acquired', { prIdOrIds });\n        try {\n          await callback();\n        } catch (err) {\n          console.log('lock: release pr (with error)', { prIdOrIds });\n          release();\n          reject(err);\n          return;\n        }\n        console.log('lock: release pr', { prIdOrIds });\n        release();\n        resolve();\n      });\n    });\n\n  const reschedule = (context: Context<any>, pr: LockedMergePr) => {\n    if (!pr) throw new Error('Cannot reschedule undefined');\n    context.log.info('reschedule', pr);\n    setTimeout(() => {\n      lockPROrPRS('reschedule', () => {\n        return lockPROrPRS(String(pr.id), async () => {\n          const prResult = await context.github.pulls.get(\n            context.repo({\n              pull_number: pr.number,\n            }),\n          );\n          await autoMergeIfPossible(context, repoContext, prResult.data);\n        });\n      });\n    }, 1000);\n  };\n\n  return Object.assign(repoContext, {\n    labels,\n    protectedLabelIds,\n    hasNeedsReview,\n    hasRequestedReview,\n    hasChangesRequestedReview,\n    hasApprovesReview,\n    getNeedsReviewGroupNames,\n\n    getMergeLockedPr: () => lockMergePr,\n    addMergeLockPr: (pr: LockedMergePr): void => {\n      console.log('merge lock: lock', pr);\n      if (lockMergePr && String(lockMergePr.number) === String(pr.number)) {\n        return;\n      }\n      if (lockMergePr) throw new Error('Already have lock');\n      lockMergePr = pr;\n    },\n    removePrFromAutomergeQueue: (context, prNumber: number | string): void => {\n      context.log('merge lock: remove', { prNumber });\n      if (lockMergePr && String(lockMergePr.number) === String(prNumber)) {\n        lockMergePr = automergeQueue.shift();\n        context.log('merge lock: next', { lockMergePr });\n        if (lockMergePr) {\n          reschedule(context, lockMergePr);\n        }\n      } else {\n        automergeQueue = automergeQueue.filter(\n          (value) => String(value.number) !== String(prNumber),\n        );\n      }\n    },\n    pushAutomergeQueue: (pr: LockedMergePr): void => {\n      console.log('merge lock: push queue', {\n        pr,\n        lockMergePr,\n        automergeQueue,\n      });\n      if (!automergeQueue.some((p) => p.number === pr.number)) {\n        automergeQueue.push(pr);\n      }\n    },\n    reschedule,\n\n    lockPROrPRS,\n  } as RepoContextWithoutTeamContext<GroupNames>);\n}\n\nconst repoContextsPromise = new Map<number, Promise<RepoContext>>();\nconst repoContexts = new Map<number, RepoContext>();\n\nexport const obtainRepoContext = (\n  context: Context<any>,\n): Promise<RepoContext> | RepoContext | null => {\n  const repo = context.payload.repository;\n  if (\n    repo.name === 'reviewflow-test' &&\n    process.env.NAME !== 'reviewflow-test'\n  ) {\n    return null;\n  }\n  const owner = repo.owner;\n  if (!orgsConfigs[owner.login]) {\n    console.warn(owner.login, Object.keys(orgsConfigs));\n    return null;\n  }\n  const key = repo.id;\n\n  const existingRepoContext = repoContexts.get(key);\n  if (existingRepoContext) return existingRepoContext;\n\n  const existingPromise = repoContextsPromise.get(key);\n  if (existingPromise) return Promise.resolve(existingPromise);\n\n  const promise = initRepoContext(context, orgsConfigs[owner.login]);\n  repoContextsPromise.set(key, promise);\n\n  return promise.then((repoContext) => {\n    repoContextsPromise.delete(key);\n    repoContexts.set(key, repoContext);\n    return repoContext;\n  });\n};\n","import Webhooks from '@octokit/webhooks';\nimport { Context } from 'probot';\nimport { obtainRepoContext, RepoContext } from '../context/repoContext';\n\nexport type Handler<T = any> = (\n  context: Context<T>,\n  repoContext: RepoContext,\n) => Promise<void>;\n\nexport type CallbackWithRepoContext = (\n  repoContext: RepoContext,\n) => void | Promise<void>;\n\nexport const handlerPullRequestChange = async <\n  T extends Webhooks.WebhookPayloadPullRequest\n>(\n  context: Context<T>,\n  callback: CallbackWithRepoContext,\n): Promise<void> => {\n  const repoContext = await obtainRepoContext(context);\n  if (!repoContext) return;\n\n  repoContext.lockPROrPRS(String(context.payload.pull_request.id), async () => {\n    await callback(repoContext);\n  });\n};\n\ntype CallbackContextAndRepoContext<T> = (\n  context: Context<T>,\n  repoContext: RepoContext,\n) => void | Promise<void>;\n\nexport const createHandlerPullRequestChange = <\n  T extends Webhooks.WebhookPayloadPullRequest\n>(\n  callback: CallbackContextAndRepoContext<T>,\n) => (context: Context<T>) => {\n  return handlerPullRequestChange(context, (repoContext) =>\n    callback(context, repoContext),\n  );\n};\n\nexport const createHandlerPullRequestsChange = <T>(\n  getPullRequests: (\n    context: Context<T>,\n    repoContext: RepoContext,\n  ) => { id: string | number }[],\n  callback: CallbackContextAndRepoContext<T>,\n) => async (context: Context<T>): Promise<void> => {\n  const repoContext = await obtainRepoContext(context);\n  if (!repoContext) return;\n\n  const prs = getPullRequests(context, repoContext);\n  if (prs.length === 0) return;\n  return repoContext.lockPROrPRS(prs.map((pr) => String(pr.id)), () =>\n    callback(context, repoContext),\n  );\n};\n","import Webhooks from '@octokit/webhooks';\nimport { Handler } from '../utils';\n\nexport const autoAssignPRToCreator: Handler<\n  Webhooks.WebhookPayloadPullRequest\n> = async (context, repoContext) => {\n  if (!repoContext.config.autoAssignToCreator) return;\n\n  const pr = context.payload.pull_request;\n  if (pr.assignees.length !== 0) return;\n  if (pr.user.type === 'Bot') return;\n\n  await context.github.issues.addAssignees(\n    context.issue({\n      assignees: [pr.user.login],\n    }),\n  );\n};\n","export const cleanTitle = (title: string): string =>\n  title\n    .trim()\n    .replace(/[\\s-]+\\[?\\s*ONK[- ](\\d+)\\s*]?\\s*$/i, ' ONK-$1')\n    .replace(/^([A-Za-z]+)[/:]\\s*/, (s, arg1) => `${arg1.toLowerCase()}: `)\n    .replace(/^Revert \"([^\"]+)\"$/, 'revert: $1')\n    // eslint-disable-next-line unicorn/no-unsafe-regex\n    .replace(/^(revert:.*)(\\s+\\(#\\d+\\))$/, '$1');\n","import { StatusInfo } from '../../../orgsConfigs/types';\nimport { parseBody } from './parseBody';\nimport { Options, optionsLabels } from './prOptions';\n\nconst toMarkdownOptions = (options: Record<Options, boolean>) => {\n  return optionsLabels\n    .map(\n      ({ name, label }) =>\n        `- [${options[name] ? 'x' : ' '}] <!-- reviewflow-${name} -->${label}`,\n    )\n    .join('\\n');\n};\n\nconst toMarkdownInfos = (infos: StatusInfo[]) => {\n  return infos\n    .map((info) => {\n      if (info.url) return `[${info.title}](${info.url})`;\n      return info.title;\n    })\n    .join('\\n');\n};\n\ninterface UpdatedBodyWithOptions {\n  body: string;\n  options?: Record<Options, boolean>;\n}\n\nexport const updateBody = (\n  body: string,\n  defaultConfig: Record<Options, boolean>,\n  infos?: StatusInfo[],\n  updateOptions?: Partial<Record<Options, boolean>>,\n): UpdatedBodyWithOptions => {\n  const parsed = parseBody(body, defaultConfig);\n  if (!parsed) {\n    console.info('could not parse body');\n    return { body };\n  }\n  const {\n    content,\n    ending,\n    reviewflowContentCol,\n    reviewflowContentColPrefix,\n    reviewflowContentColSuffix,\n    options,\n  } = parsed;\n\n  // eslint-disable-next-line no-nested-ternary\n  const infosParagraph = !infos\n    ? reviewflowContentCol.replace(\n        // eslint-disable-next-line unicorn/no-unsafe-regex\n        /^\\s*(?:(#### Infos:.*)?#### Options:)?.*$/s,\n        '$1',\n      )\n    : infos.length !== 0\n    ? `#### Infos:\\n${toMarkdownInfos(infos)}\\n`\n    : '';\n\n  const updatedOptions = !updateOptions\n    ? options\n    : { ...options, ...updateOptions };\n\n  return {\n    options: updatedOptions,\n    body: `${content}${reviewflowContentColPrefix}\n${infosParagraph}#### Options:\n${toMarkdownOptions(updatedOptions)}\n${reviewflowContentColSuffix}${ending || ''}`,\n  };\n};\n","import Webhooks from '@octokit/webhooks';\nimport { Context } from 'probot';\nimport { RepoContext } from '../../context/repoContext';\nimport { StatusError, StatusInfo } from '../../orgsConfigs/types';\nimport { cleanTitle } from './utils/cleanTitle';\nimport { updateBody } from './utils/updateBody';\nimport { autoMergeIfPossible } from './autoMergeIfPossible';\n\ninterface StatusWithInfo {\n  name: string;\n  info: StatusInfo;\n  error?: undefined;\n}\n\ninterface StatusWithError {\n  name: string;\n  error: StatusError;\n  info?: undefined;\n}\n\ntype Status = StatusWithInfo | StatusWithError;\n\nconst ExcludesFalsy = (Boolean as any) as <T>(\n  x: T | false | null | undefined,\n) => x is T;\n\nexport const editOpenedPR = async (\n  context: Context<Webhooks.WebhookPayloadPullRequest>,\n  repoContext: RepoContext,\n): Promise<{ skipAutoMerge: boolean }> => {\n  const repo = context.payload.repository;\n  const pr = context.payload.pull_request;\n\n  // do not lint pr from forks\n  if (pr.head.repo.id !== repo.id) return { skipAutoMerge: true };\n\n  const title = repoContext.config.trimTitle ? cleanTitle(pr.title) : pr.title;\n\n  const isPrFromBot = pr.user.type === 'Bot';\n\n  const statuses: Status[] = [];\n\n  const errorRule = repoContext.config.parsePR.title.find((rule) => {\n    if (rule.bot === false && isPrFromBot) return false;\n\n    const match = rule.regExp.exec(pr.title);\n    if (match === null) {\n      if (rule.status) {\n        statuses.push({ name: rule.status, error: rule.error });\n      }\n      return true;\n    }\n\n    if (rule.status && rule.statusInfoFromMatch) {\n      statuses.push({\n        name: rule.status,\n        info: rule.statusInfoFromMatch(match),\n      });\n      return false;\n    }\n\n    return false;\n  });\n\n  const date = new Date().toISOString();\n\n  const hasLintPrCheck = (await context.github.checks.listForRef(\n    context.repo({\n      ref: pr.head.sha,\n    }),\n  )).data.check_runs.find(\n    (check) => check.name === `${process.env.NAME}/lint-pr`,\n  );\n\n  await Promise.all<any>(\n    [\n      ...statuses.map(({ name, error, info }) =>\n        context.github.repos.createStatus(\n          context.repo({\n            context: `${process.env.NAME}/${name}`,\n            sha: pr.head.sha,\n            state: (error ? 'failure' : 'success') as 'failure' | 'success',\n            target_url: error ? undefined : (info as StatusInfo).url,\n            description: error ? error.title : (info as StatusInfo).title,\n          }),\n        ),\n      ),\n      hasLintPrCheck &&\n        context.github.checks.create(\n          context.repo({\n            name: `${process.env.NAME}/lint-pr`,\n            head_sha: pr.head.sha,\n            status: 'completed' as 'completed',\n            conclusion: (errorRule ? 'failure' : 'success') as\n              | 'failure'\n              | 'success',\n            started_at: date,\n            completed_at: date,\n            output: errorRule\n              ? errorRule.error\n              : {\n                  title: '✓ Your PR is valid',\n                  summary: '',\n                },\n          }),\n        ),\n      !hasLintPrCheck &&\n        context.github.repos.createStatus(\n          context.repo({\n            context: `${process.env.NAME}/lint-pr`,\n            sha: pr.head.sha,\n            state: (errorRule ? 'failure' : 'success') as 'failure' | 'success',\n            target_url: undefined,\n            description: errorRule\n              ? errorRule.error.title\n              : '✓ Your PR is valid',\n          }),\n        ),\n    ].filter(ExcludesFalsy),\n  );\n\n  const featureBranchLabel = repoContext.labels['feature-branch'];\n  const automergeLabel = repoContext.labels['merge/automerge'];\n\n  const prHasFeatureBranchLabel = Boolean(\n    featureBranchLabel &&\n      pr.labels.find((label): boolean => label.id === featureBranchLabel.id),\n  );\n\n  const prHasAutoMergeLabel = Boolean(\n    automergeLabel &&\n      pr.labels.find((label): boolean => label.id === automergeLabel.id),\n  );\n\n  const defaultOptions = {\n    ...repoContext.config.prDefaultOptions,\n    autoMerge: prHasAutoMergeLabel,\n    featureBranch: prHasFeatureBranchLabel,\n  };\n\n  const { body, options } = updateBody(pr.body, defaultOptions, statuses\n    .filter((status) => status.info && status.info.inBody)\n    .map((status) => status.info) as StatusInfo[]);\n\n  const hasDiffInTitle = pr.title !== title;\n  const hasDiffInBody = pr.body !== body;\n  if (hasDiffInTitle || hasDiffInBody) {\n    const update: Partial<Record<'title' | 'body', string>> = {};\n    if (hasDiffInTitle) {\n      update.title = title;\n      pr.title = title;\n    }\n    if (hasDiffInBody) {\n      update.body = body;\n      pr.body = body;\n    }\n\n    await context.github.issues.update(context.issue(update));\n  }\n\n  if (options && (featureBranchLabel || automergeLabel)) {\n    if (featureBranchLabel) {\n      if (prHasFeatureBranchLabel && !options.featureBranch) {\n        await context.github.issues.removeLabel(\n          context.issue({ name: featureBranchLabel.name }),\n        );\n      }\n      if (options.featureBranch && !prHasFeatureBranchLabel) {\n        await context.github.issues.addLabels(\n          context.issue({ labels: [featureBranchLabel.name] }),\n        );\n      }\n    }\n\n    if (automergeLabel) {\n      if (prHasAutoMergeLabel && !options.autoMerge) {\n        await context.github.issues.removeLabel(\n          context.issue({ name: automergeLabel.name }),\n        );\n        repoContext.removePrFromAutomergeQueue(context, pr.number);\n      }\n      if (options.autoMerge && !prHasAutoMergeLabel) {\n        const result = await context.github.issues.addLabels(\n          context.issue({ labels: [automergeLabel.name] }),\n        );\n        await autoMergeIfPossible(\n          context,\n          repoContext,\n          context.payload.pull_request,\n          result.data,\n        );\n      }\n      return { skipAutoMerge: true };\n    }\n  }\n\n  return { skipAutoMerge: false };\n};\n","import Webhooks from '@octokit/webhooks';\nimport { Context } from 'probot';\nimport { LabelResponse } from '../../context/initRepoLabels';\nimport { RepoContext } from '../../context/repoContext';\n\nconst addStatusCheck = async function<\n  E extends Webhooks.WebhookPayloadPullRequest\n>(\n  context: Context<E>,\n  pr: any,\n  { state, description }: { state: 'failure' | 'success'; description: string },\n): Promise<void> {\n  const hasPrCheck = (await context.github.checks.listForRef(\n    context.repo({\n      ref: pr.head.sha,\n    }),\n  )).data.check_runs.find((check) => check.name === process.env.NAME);\n\n  context.log.info('add status check', { hasPrCheck, state, description });\n\n  if (hasPrCheck) {\n    await context.github.checks.create(\n      context.repo({\n        name: process.env.NAME as string,\n        head_sha: pr.head.sha,\n        started_at: pr.created_at,\n        status: 'completed',\n        conclusion: state,\n        completed_at: new Date().toISOString(),\n        output: {\n          title: description,\n          summary: '',\n        },\n      }),\n    );\n  } else {\n    await context.github.repos.createStatus(\n      context.repo({\n        context: process.env.NAME,\n        sha: pr.head.sha,\n        state,\n        target_url: undefined,\n        description,\n      }),\n    );\n  }\n};\n\nconst createFailedStatusCheck = <E extends Webhooks.WebhookPayloadPullRequest>(\n  context: Context<E>,\n  pr: any,\n  description: string,\n): Promise<void> =>\n  addStatusCheck(context, pr, {\n    state: 'failure',\n    description,\n  });\n\nexport const updateStatusCheckFromLabels = (\n  context: Context<any>,\n  repoContext: RepoContext,\n  pr: any = context.payload.pull_request,\n  labels: LabelResponse[] = pr.labels || [],\n): Promise<void> => {\n  context.log.info('updateStatusCheckFromLabels', {\n    labels: labels.map((l) => l && l.name),\n    hasNeedsReview: repoContext.hasNeedsReview(labels),\n    hasApprovesReview: repoContext.hasApprovesReview(labels),\n  });\n\n  if (pr.requested_reviewers.length !== 0) {\n    return createFailedStatusCheck(\n      context,\n      pr,\n      `Awaiting review from: ${pr.requested_reviewers\n        .map((rr: any) => rr.login)\n        .join(', ')}`,\n    );\n  }\n\n  if (repoContext.hasChangesRequestedReview(labels)) {\n    return createFailedStatusCheck(\n      context,\n      pr,\n      'Changes requested ! Push commits or discuss changes then re-request a review.',\n    );\n  }\n\n  const needsReviewGroupNames = repoContext.getNeedsReviewGroupNames(labels);\n\n  if (needsReviewGroupNames.length !== 0) {\n    return createFailedStatusCheck(\n      context,\n      pr,\n      `Awaiting review from: ${needsReviewGroupNames.join(\n        ', ',\n      )}. Perhaps request someone ?`,\n    );\n  }\n\n  if (!repoContext.hasApprovesReview(labels)) {\n    if (repoContext.config.requiresReviewRequest) {\n      return createFailedStatusCheck(\n        context,\n        pr,\n        'Awaiting review... Perhaps request someone ?',\n      );\n    }\n  }\n\n  // if (\n  //   repoContext.config.requiresReviewRequest &&\n  //   !repoContext.hasRequestedReview(labels)\n  // ) {\n  //   return  createFailedStatusCheck(\n  //     context,\n  //     pr,\n  //     'You need to request someone to review the PR',\n  //   );\n  //   return;\n  // }\n  // return  createInProgressStatusCheck(context);\n  // } else if (repoContext.hasApprovesReview(labels)) {\n  return addStatusCheck(context, pr, {\n    state: 'success',\n    description: '✓ PR ready to merge !',\n  });\n  // }\n};\n","import Webhooks from '@octokit/webhooks';\nimport { Context } from 'probot';\nimport { LabelResponse } from '../../context/initRepoLabels';\nimport { GroupLabels } from '../../orgsConfigs/types';\nimport { RepoContext } from '../../context/repoContext';\nimport { updateStatusCheckFromLabels } from './updateStatusCheckFromLabels';\n\nexport const updateReviewStatus = async <\n  E extends Webhooks.WebhookPayloadPullRequest,\n  GroupNames extends string = any\n>(\n  context: Context<E>,\n  repoContext: RepoContext,\n  reviewGroup: GroupNames,\n  {\n    add: labelsToAdd,\n    remove: labelsToRemove,\n  }: {\n    add?: (GroupLabels | false | undefined)[];\n    remove?: (GroupLabels | false | undefined)[];\n  },\n): Promise<LabelResponse[]> => {\n  context.log.info('updateReviewStatus', {\n    reviewGroup,\n    labelsToAdd,\n    labelsToRemove,\n  });\n\n  const pr = context.payload.pull_request;\n  let prLabels: LabelResponse[] = pr.labels || [];\n  if (!reviewGroup) return prLabels;\n\n  const newLabelNames = new Set<string>(\n    prLabels.map((label: LabelResponse) => label.name),\n  );\n\n  const toAdd = new Set<GroupLabels | string>();\n  const toDelete = new Set<GroupLabels>();\n  const labels = repoContext.labels;\n\n  const getLabelFromKey = (key: GroupLabels): undefined | LabelResponse => {\n    const reviewConfig = repoContext.config.labels.review[reviewGroup];\n    if (!reviewConfig) return undefined;\n\n    return reviewConfig[key] && labels[reviewConfig[key]]\n      ? labels[reviewConfig[key]]\n      : undefined;\n  };\n\n  if (labelsToAdd) {\n    labelsToAdd.forEach((key) => {\n      if (!key) return;\n      const label = getLabelFromKey(key);\n      if (!label || prLabels.some((prLabel) => prLabel.id === label.id)) {\n        return;\n      }\n      newLabelNames.add(label.name);\n      toAdd.add(key);\n    });\n  }\n\n  if (labelsToRemove) {\n    labelsToRemove.forEach((key) => {\n      if (!key) return;\n      const label = getLabelFromKey(key);\n      if (!label) return;\n      const existing = prLabels.find((prLabel) => prLabel.id === label.id);\n      if (existing) {\n        newLabelNames.delete(existing.name);\n        toDelete.add(key);\n      }\n    });\n  }\n\n  // TODO move that elsewhere\n\n  repoContext.getTeamsForLogin(pr.user.login).forEach((teamName) => {\n    const team = repoContext.config.teams[teamName];\n    if (team.labels) {\n      team.labels.forEach((labelKey) => {\n        const label = repoContext.labels[labelKey];\n        if (label && !prLabels.some((prLabel) => prLabel.id === label.id)) {\n          newLabelNames.add(label.name);\n          toAdd.add(labelKey);\n        }\n      });\n    }\n  });\n\n  const newLabelNamesArray = [...newLabelNames];\n\n  context.log.info('updateReviewStatus', {\n    reviewGroup,\n    toAdd: [...toAdd],\n    toDelete: [...toDelete],\n    oldLabels: prLabels.map((l: LabelResponse) => l.name),\n    newLabelNames: newLabelNamesArray,\n  });\n\n  // if (process.env.DRY_RUN) return;\n\n  if (toAdd.size || toDelete.size) {\n    const result = await context.github.issues.replaceLabels(\n      context.issue({\n        labels: newLabelNamesArray,\n      }),\n    );\n    prLabels = result.data;\n  }\n\n  // if (toAdd.has('needsReview')) {\n  //   createInProgressStatusCheck(context);\n  // } else if (\n  //   toDelete.has('needsReview') ||\n  //   (prLabels.length === 0 && toAdd.size === 1 && toAdd.has('approved'))\n  // ) {\n  await updateStatusCheckFromLabels(context, repoContext, pr, prLabels);\n  // }\n\n  return prLabels;\n};\n","import Webhooks from '@octokit/webhooks';\nimport { Context } from 'probot';\nimport { RepoContext } from '../../context/repoContext';\nimport { autoMergeIfPossible } from './autoMergeIfPossible';\n\nexport const autoApproveAndAutoMerge = async (\n  context: Context<Webhooks.WebhookPayloadPullRequest>,\n  repoContext: RepoContext,\n): Promise<void> => {\n  // const autoMergeLabel = repoContext.labels['merge/automerge'];\n  const codeApprovedLabel = repoContext.labels['code/approved'];\n  const prLabels = context.payload.pull_request.labels;\n  if (prLabels.find((l): boolean => l.id === codeApprovedLabel.id)) {\n    await context.github.pulls.createReview(\n      context.issue({ event: 'APPROVE' }),\n    );\n  }\n\n  await autoMergeIfPossible(context, repoContext);\n};\n","import { Application } from 'probot';\nimport { createHandlerPullRequestChange } from './utils';\nimport { autoAssignPRToCreator } from './actions/autoAssignPRToCreator';\nimport { editOpenedPR } from './actions/editOpenedPR';\nimport { updateReviewStatus } from './actions/updateReviewStatus';\nimport { autoApproveAndAutoMerge } from './actions/autoApproveAndAutoMerge';\n\nexport default function opened(app: Application): void {\n  app.on(\n    'pull_request.opened',\n    createHandlerPullRequestChange(\n      async (context, repoContext): Promise<void> => {\n        const fromRenovate = context.payload.pull_request.head.ref.startsWith(\n          'renovate/',\n        );\n\n        await Promise.all<unknown>([\n          autoAssignPRToCreator(context, repoContext),\n          editOpenedPR(context, repoContext),\n          fromRenovate\n            ? autoApproveAndAutoMerge(context, repoContext)\n            : updateReviewStatus(context, repoContext, 'dev', {\n                add: ['needsReview'],\n                remove: ['approved', 'changesRequested'],\n              }),\n        ]);\n      },\n    ),\n  );\n}\n","import { Application } from 'probot';\nimport { createHandlerPullRequestChange } from './utils';\nimport { updateReviewStatus } from './actions/updateReviewStatus';\nimport { parseBody } from './actions/utils/parseBody';\n\nexport default function closed(app: Application): void {\n  app.on(\n    'pull_request.closed',\n    createHandlerPullRequestChange(\n      async (context, repoContext): Promise<void> => {\n        const repo = context.payload.repository;\n        const pr = context.payload.pull_request;\n\n        if (pr.merged) {\n          const parsedBody =\n            pr.head.repo.id === repo.id &&\n            parseBody(pr.body, repoContext.config.prDefaultOptions);\n\n          await Promise.all([\n            repoContext.removePrFromAutomergeQueue(context, pr.number),\n            parsedBody && parsedBody.options.deleteAfterMerge\n              ? context.github.git\n                  .deleteRef(context.repo({ ref: `heads/${pr.head.ref}` }))\n                  .catch(() => {})\n              : undefined,\n          ]);\n        } else {\n          await Promise.all([\n            repoContext.removePrFromAutomergeQueue(context, pr.number),\n            updateReviewStatus(context, repoContext, 'dev', {\n              remove: ['needsReview'],\n            }),\n          ]);\n        }\n      },\n    ),\n  );\n}\n","import { Application } from 'probot';\nimport { createHandlerPullRequestChange } from './utils';\nimport { updateReviewStatus } from './actions/updateReviewStatus';\n\nexport default function reviewRequested(app: Application): void {\n  app.on(\n    'pull_request.review_requested',\n    createHandlerPullRequestChange(\n      async (context, repoContext): Promise<void> => {\n        const sender = context.payload.sender;\n\n        // ignore if sender is self (dismissed review rerequest review)\n        if (sender.type === 'Bot') return;\n\n        const pr = context.payload.pull_request;\n        const reviewer = (context.payload as any).requested_reviewer;\n\n        const reviewerGroup = repoContext.getReviewerGroup(reviewer.login);\n        const shouldWait = false;\n        // repoContext.reviewShouldWait(reviewerGroup, pr.requested_reviewers, { includesWaitForGroups: true });\n\n        if (reviewerGroup && repoContext.config.labels.review[reviewerGroup]) {\n          const { data: reviews } = await context.github.pulls.listReviews(\n            context.issue({ per_page: 50 }),\n          );\n          const hasChangesRequestedInReviews = reviews.some(\n            (review) =>\n              repoContext.getReviewerGroup(review.user.login) ===\n                reviewerGroup &&\n              review.state === 'REQUEST_CHANGES' &&\n              // In case this is a rerequest for review\n              review.user.login !== reviewer.login,\n          );\n\n          if (!hasChangesRequestedInReviews) {\n            await updateReviewStatus(context, repoContext, reviewerGroup, {\n              add: ['needsReview', !shouldWait && 'requested'],\n              remove: ['approved', 'changesRequested'],\n            });\n          }\n        }\n\n        if (sender.login === reviewer.login) return;\n\n        if (!shouldWait && repoContext.slack) {\n          repoContext.slack.postMessage(\n            reviewer.login,\n            `:eyes: ${repoContext.slack.mention(\n              sender.login,\n            )} requests your review on ${pr.html_url} !\\n> ${pr.title}`,\n          );\n        }\n      },\n    ),\n  );\n}\n","import { Application } from 'probot';\nimport { createHandlerPullRequestChange } from './utils';\nimport { updateReviewStatus } from './actions/updateReviewStatus';\n\nexport default function reviewRequestRemoved(app: Application): void {\n  app.on(\n    'pull_request.review_request_removed',\n    createHandlerPullRequestChange(\n      async (context, repoContext): Promise<void> => {\n        const sender = context.payload.sender;\n        const pr = context.payload.pull_request;\n        const reviewer = (context.payload as any).requested_reviewer;\n\n        const reviewerGroup = repoContext.getReviewerGroup(reviewer.login);\n\n        if (reviewerGroup && repoContext.config.labels.review[reviewerGroup]) {\n          const hasRequestedReviewsForGroup = repoContext.reviewShouldWait(\n            reviewerGroup,\n            pr.requested_reviewers,\n            {\n              includesReviewerGroup: true,\n            },\n          );\n\n          const { data: reviews } = await context.github.pulls.listReviews(\n            context.issue({ per_page: 50 }),\n          );\n\n          const hasChangesRequestedInReviews = reviews.some(\n            (review) =>\n              repoContext.getReviewerGroup(review.user.login) ===\n                reviewerGroup && review.state === 'REQUEST_CHANGES',\n          );\n\n          const hasApprovedInReviews = reviews.some(\n            (review) =>\n              repoContext.getReviewerGroup(review.user.login) ===\n                reviewerGroup && review.state === 'APPROVED',\n          );\n\n          const approved =\n            !hasRequestedReviewsForGroup &&\n            !hasChangesRequestedInReviews &&\n            hasApprovedInReviews;\n          await updateReviewStatus(context, repoContext, reviewerGroup, {\n            add: [\n              // if changes requested by the one which requests was removed\n              hasChangesRequestedInReviews && 'changesRequested',\n              // if was already approved by another member in the group and has no other requests waiting\n              approved && 'approved',\n            ],\n            // remove labels if has no other requests waiting\n            remove: [\n              approved && 'needsReview',\n              !hasRequestedReviewsForGroup &&\n                !hasChangesRequestedInReviews &&\n                'requested',\n            ],\n          });\n        }\n\n        if (sender.login === reviewer.login) return;\n\n        if (repoContext.slack) {\n          repoContext.slack.postMessage(\n            reviewer.login,\n            `:skull_and_crossbones: ${repoContext.slack.mention(\n              sender.login,\n            )} removed the request for your review on ${pr.html_url}`,\n          );\n        }\n      },\n    ),\n  );\n}\n","import { Application } from 'probot';\nimport { createHandlerPullRequestChange } from './utils';\nimport { autoMergeIfPossible } from './actions/autoMergeIfPossible';\nimport { updateReviewStatus } from './actions/updateReviewStatus';\n\nexport default function reviewSubmitted(app: Application): void {\n  app.on(\n    'pull_request_review.submitted',\n    createHandlerPullRequestChange(\n      async (context, repoContext): Promise<void> => {\n        const pr = context.payload.pull_request;\n        const { user: reviewer, state } = (context.payload as any).review;\n        if (pr.user.login === reviewer.login) return;\n\n        const reviewerGroup = repoContext.getReviewerGroup(reviewer.login);\n        let merged;\n\n        if (reviewerGroup && repoContext.config.labels.review[reviewerGroup]) {\n          const hasRequestedReviewsForGroup = repoContext.reviewShouldWait(\n            reviewerGroup,\n            pr.requested_reviewers,\n            {\n              includesReviewerGroup: true,\n              // TODO reenable this when accepted can notify request review to slack (dev accepted => design requested) and flag to disable for label (approved design ; still waiting for dev ?)\n              // includesWaitForGroups: true,\n            },\n          );\n          const { data: reviews } = await context.github.pulls.listReviews(\n            context.issue({ per_page: 50 }),\n          );\n          const hasChangesRequestedInReviews = reviews.some(\n            (review) =>\n              repoContext.getReviewerGroup(review.user.login) ===\n                reviewerGroup && review.state === 'REQUEST_CHANGES',\n          );\n\n          const approved =\n            !hasRequestedReviewsForGroup &&\n            !hasChangesRequestedInReviews &&\n            state === 'approved';\n\n          const newLabels = await updateReviewStatus(\n            context,\n            repoContext,\n            reviewerGroup,\n            {\n              add: [\n                approved && 'approved',\n                state === 'changes_requested' && 'changesRequested',\n              ],\n              remove: [\n                approved && 'needsReview',\n                !(\n                  hasRequestedReviewsForGroup || state === 'changes_requested'\n                ) && 'requested',\n                state === 'approved' &&\n                  !hasChangesRequestedInReviews &&\n                  'changesRequested',\n                state === 'changes_requested' && 'approved',\n              ],\n            },\n          );\n\n          if (approved && !hasChangesRequestedInReviews) {\n            merged = await autoMergeIfPossible(\n              context,\n              repoContext,\n              pr,\n              newLabels,\n            );\n          }\n        }\n\n        const mention = repoContext.slack.mention(reviewer.login);\n        const prUrl = pr.html_url;\n\n        const message = (() => {\n          if (state === 'changes_requested') {\n            return `:x: ${mention} requests changes on ${prUrl}`;\n          }\n          if (state === 'approved') {\n            return `:clap: :white_check_mark: ${mention} approves ${prUrl}${\n              merged ? ' and PR is merged :tada:' : ''\n            }`;\n          }\n          return `:speech_balloon: ${mention} commented on ${prUrl}`;\n        })();\n\n        repoContext.slack.postMessage(pr.user.login, message);\n      },\n    ),\n  );\n}\n","import { Application } from 'probot';\nimport { createHandlerPullRequestChange } from './utils';\nimport { updateReviewStatus } from './actions/updateReviewStatus';\n\nexport default function reviewDismissed(app: Application): void {\n  app.on(\n    'pull_request_review.dismissed',\n    createHandlerPullRequestChange(\n      async (context, repoContext): Promise<void> => {\n        const sender = context.payload.sender;\n        const pr = context.payload.pull_request;\n        const reviewer = (context.payload as any).review.user;\n\n        const reviewerGroup = repoContext.getReviewerGroup(reviewer.login);\n\n        if (reviewerGroup && repoContext.config.labels.review[reviewerGroup]) {\n          const { data: reviews } = await context.github.pulls.listReviews(\n            context.issue({ per_page: 50 }),\n          );\n          const hasChangesRequestedInReviews = reviews.some(\n            (review) =>\n              repoContext.getReviewerGroup(review.user.login) ===\n                reviewerGroup && review.state === 'REQUEST_CHANGES',\n          );\n\n          await updateReviewStatus(context, repoContext, reviewerGroup, {\n            add: ['needsReview', 'requested'],\n            remove: [\n              !hasChangesRequestedInReviews && 'changesRequested',\n              'approved',\n            ],\n          });\n        }\n\n        if (repoContext.slack) {\n          if (sender.login === reviewer.login) {\n            repoContext.slack.postMessage(\n              pr.user.login,\n              `:skull: ${repoContext.slack.mention(\n                reviewer.login,\n              )} dismissed his review on ${pr.html_url}`,\n            );\n          } else {\n            repoContext.slack.postMessage(\n              reviewer.login,\n              `:skull: ${repoContext.slack.mention(\n                sender.login,\n              )} dismissed your review on ${pr.html_url}`,\n            );\n          }\n        }\n      },\n    ),\n  );\n}\n","import { Application } from 'probot';\nimport { createHandlerPullRequestChange } from './utils';\nimport { editOpenedPR } from './actions/editOpenedPR';\nimport { updateStatusCheckFromLabels } from './actions/updateStatusCheckFromLabels';\nimport { autoMergeIfPossible } from './actions/autoMergeIfPossible';\n\nexport default function synchronize(app: Application): void {\n  app.on(\n    'pull_request.synchronize',\n    createHandlerPullRequestChange(\n      async (context, repoContext): Promise<void> => {\n        // old and new sha\n        // const { before, after } = context.payload;\n\n        await Promise.all([\n          editOpenedPR(context, repoContext),\n          // addStatusCheckToLatestCommit\n          updateStatusCheckFromLabels(context, repoContext),\n          // call autoMergeIfPossible to re-add to the queue when push is fixed\n          autoMergeIfPossible(context, repoContext),\n        ]);\n      },\n    ),\n  );\n}\n","import { Application } from 'probot';\nimport { editOpenedPR } from './actions/editOpenedPR';\nimport { createHandlerPullRequestChange } from './utils';\nimport { autoMergeIfPossible } from './actions/autoMergeIfPossible';\n\nexport default function edited(app: Application): void {\n  app.on(\n    'pull_request.edited',\n    createHandlerPullRequestChange(\n      async (context, repoContext): Promise<void> => {\n        const sender = context.payload.sender;\n        if (\n          sender.type === 'Bot' &&\n          sender.login === `${process.env.NAME}[bot]`\n        ) {\n          return;\n        }\n\n        const { skipAutoMerge } = await editOpenedPR(context, repoContext);\n        if (!skipAutoMerge) await autoMergeIfPossible(context, repoContext);\n      },\n    ),\n  );\n}\n","import Webhooks from '@octokit/webhooks';\nimport { Context } from 'probot';\nimport { RepoContext } from '../../context/repoContext';\nimport { updateBody } from './utils/updateBody';\nimport { Options } from './utils/prOptions';\n\nexport const updatePrBody = async <\n  E extends Webhooks.WebhookPayloadPullRequest\n>(\n  context: Context<E>,\n  repoContext: RepoContext,\n  updateOptions: Partial<Record<Options, boolean>>,\n): Promise<void> => {\n  const prBody = context.payload.pull_request.body;\n  const { body } = updateBody(\n    prBody,\n    repoContext.config.prDefaultOptions,\n    undefined,\n    updateOptions,\n  );\n\n  if (body !== prBody) {\n    await context.github.pulls.update(context.issue({ body }));\n  }\n};\n","import Webhooks from '@octokit/webhooks';\nimport { Application, Context } from 'probot';\nimport { handlerPullRequestChange } from './utils';\nimport { autoMergeIfPossible } from './actions/autoMergeIfPossible';\nimport { updateStatusCheckFromLabels } from './actions/updateStatusCheckFromLabels';\nimport { updatePrBody } from './actions/updatePrBody';\n\nexport default function labelsChanged(app: Application): void {\n  app.on(\n    ['pull_request.labeled', 'pull_request.unlabeled'],\n    async (context: Context<Webhooks.WebhookPayloadPullRequest>) => {\n      const sender = context.payload.sender;\n      const fromRenovate =\n        sender.type === 'Bot' && sender.login === 'renovate[bot]';\n      context.payload.pull_request.head.ref.startsWith('renovate/');\n\n      if (sender.type === 'Bot' && !fromRenovate) {\n        return;\n      }\n\n      await handlerPullRequestChange(context, async (repoContext) => {\n        const label = (context.payload as any).label;\n        if (fromRenovate) {\n          const codeApprovedLabel = repoContext.labels['code/approved'];\n          const autoMergeLabel = repoContext.labels['merge/automerge'];\n          if (context.payload.action === 'labeled') {\n            if (codeApprovedLabel && label.id === codeApprovedLabel.id) {\n              // const { data: reviews } = await context.github.pulls.listReviews(\n              //   context.issue({ per_page: 1 }),\n              // );\n              // if (reviews.length !== 0) {\n              await context.github.pulls.createReview(\n                context.issue({ event: 'APPROVE' }),\n              );\n              await updateStatusCheckFromLabels(\n                context,\n                repoContext,\n                context.payload.pull_request,\n              );\n              await updatePrBody(context, repoContext, {\n                autoMergeWithSkipCi: true,\n              });\n              // }\n            } else if (autoMergeLabel && label.id === autoMergeLabel.id) {\n              await updatePrBody(context, repoContext, {\n                autoMerge: true,\n              });\n            }\n            await autoMergeIfPossible(context, repoContext);\n          }\n          return;\n        }\n\n        if (repoContext.protectedLabelIds.includes(label.id)) {\n          if (context.payload.action === 'labeled') {\n            await context.github.issues.removeLabel(\n              context.issue({ name: label.name }),\n            );\n          } else {\n            await context.github.issues.addLabels(\n              context.issue({ labels: [label.name] }),\n            );\n          }\n          return;\n        }\n\n        await updateStatusCheckFromLabels(context, repoContext);\n\n        const featureBranchLabel = repoContext.labels['feature-branch'];\n        const automergeLabel = repoContext.labels['merge/automerge'];\n\n        if (\n          (featureBranchLabel && label.id === automergeLabel.id) ||\n          (automergeLabel && label.id === automergeLabel.id)\n        ) {\n          const option: 'featureBranch' | 'autoMerge' =\n            featureBranchLabel && label.id === featureBranchLabel.id\n              ? 'featureBranch'\n              : 'autoMerge';\n          await updatePrBody(context, repoContext, {\n            [option]: context.payload.action === 'labeled',\n          });\n        } else if (context.payload.action === 'labeled') {\n          if (\n            repoContext.labels['merge/automerge'] &&\n            label.id === repoContext.labels['merge/automerge'].id\n          ) {\n            await autoMergeIfPossible(context, repoContext);\n          }\n        }\n      });\n    },\n  );\n}\n","import { Application } from 'probot';\nimport { createHandlerPullRequestsChange } from './utils';\nimport { autoMergeIfPossible } from './actions/autoMergeIfPossible';\n\nexport default function checkrunCompleted(app: Application): void {\n  app.on(\n    'check_run.completed',\n    createHandlerPullRequestsChange(\n      (context) => context.payload.check_run.pull_requests,\n      async (context, repoContext) => {\n        await Promise.all(\n          context.payload.check_run.pull_requests.map((pr) =>\n            context.github.pulls\n              .get(\n                context.repo({\n                  number: pr.number,\n                }),\n              )\n              .then((prResult) => {\n                return autoMergeIfPossible(context, repoContext, prResult.data);\n              }),\n          ),\n        );\n      },\n    ),\n  );\n}\n","import { Application } from 'probot';\nimport { createHandlerPullRequestsChange } from './utils';\nimport { autoMergeIfPossible } from './actions/autoMergeIfPossible';\n\nexport default function checksuiteCompleted(app: Application): void {\n  app.on(\n    'check_suite.completed',\n    createHandlerPullRequestsChange(\n      (context) => context.payload.check_suite.pull_requests,\n      async (context, repoContext) => {\n        await Promise.all(\n          context.payload.check_suite.pull_requests.map((pr) =>\n            context.github.pulls\n              .get(\n                context.repo({\n                  number: pr.number,\n                }),\n              )\n              .then((prResult) => {\n                return autoMergeIfPossible(context, repoContext, prResult.data);\n              }),\n          ),\n        );\n      },\n    ),\n  );\n}\n","import Webhooks from '@octokit/webhooks';\nimport { Application, Context } from 'probot';\nimport { LockedMergePr } from '../context/repoContext';\nimport { createHandlerPullRequestsChange } from './utils';\n\nconst isSameBranch = (\n  context: Context<Webhooks.WebhookPayloadStatus>,\n  lockedPr: LockedMergePr,\n): boolean => {\n  if (!lockedPr) return false;\n  return !!context.payload.branches.find((b) => b.name === lockedPr.branch);\n};\n\nexport default function status(app: Application): void {\n  app.on(\n    'status',\n    createHandlerPullRequestsChange(\n      (context, repoContext): LockedMergePr[] => {\n        const lockedPr = repoContext.getMergeLockedPr();\n        if (!lockedPr) return [];\n\n        if (isSameBranch(context, lockedPr)) {\n          return [lockedPr];\n        }\n\n        return [];\n      },\n      (context, repoContext): void => {\n        const lockedPr = repoContext.getMergeLockedPr();\n        // check if changed\n        if (isSameBranch(context, lockedPr)) {\n          repoContext.reschedule(context, lockedPr);\n        }\n      },\n    ),\n  );\n}\n","import 'dotenv/config';\nimport { Probot, Application } from 'probot';\nimport openedHandler from './pr-handlers/opened';\nimport closedHandler from './pr-handlers/closed';\nimport reviewRequestedHandler from './pr-handlers/reviewRequested';\nimport reviewRequestRemovedHandler from './pr-handlers/reviewRequestRemoved';\nimport reviewSubmittedHandler from './pr-handlers/reviewSubmitted';\nimport reviewDismissedHandler from './pr-handlers/reviewDismissed';\nimport synchromizeHandler from './pr-handlers/synchronize';\nimport editedHandler from './pr-handlers/edited';\nimport labelsChanged from './pr-handlers/labelsChanged';\nimport checkrunCompleted from './pr-handlers/checkrunCompleted';\nimport checksuiteCompleted from './pr-handlers/checksuiteCompleted';\nimport status from './pr-handlers/status';\n\nif (!process.env.NAME) process.env.NAME = 'reviewflow';\n\n// const getConfig = require('probot-config')\n// const { MongoClient } = require('mongodb');\n\n// const connect = MongoClient.connect(process.env.MONGO_URL);\n// const db = connect.then(client => client.db(process.env.MONGO_DB));\n\n// let config = await getConfig(context, 'reviewflow.yml');\n\n// eslint-disable-next-line import/no-commonjs\nProbot.run((app: Application) => {\n  openedHandler(app);\n  closedHandler(app);\n  reviewRequestedHandler(app);\n  reviewRequestRemovedHandler(app);\n\n  // app.on('pull_request.closed', async context => {\n\n  // });\n\n  // app.on('pull_request.reopened', async context => {\n\n  // });\n\n  reviewSubmittedHandler(app);\n  reviewDismissedHandler(app);\n  labelsChanged(app);\n  synchromizeHandler(app);\n  editedHandler(app);\n\n  checkrunCompleted(app);\n  checksuiteCompleted(app);\n  status(app);\n});\n"],"names":["config","slackToken","process","env","ORNIKAR_SLACK_TOKEN","autoAssignToCreator","trimTitle","requiresReviewRequest","prDefaultOptions","featureBranch","autoMergeWithSkipCi","autoMerge","deleteAfterMerge","parsePR","title","regExp","error","summary","bot","status","statusInfoFromMatch","match","issue","inBody","url","groups","dev","abarreir","ORNIKAR_EMAIL_DOMAIN","arthurflachs","rigma","damienorny","darame07","Pixy","christophehurpeau","HugoGarrido","LentnerStefan","CorentinAndre","Mxime","tilap","vlbr","design","jperriere","CoralineColasse","teams","backends","logins","labels","frontends","waitForGroups","list","name","color","review","ci","inProgress","succeeded","failed","needsReview","requested","changesRequested","approved","orgsConfigs","ornikar","options","optionsRegexps","map","option","regexp","RegExp","optionsLabels","label","commentStart","commentEnd","regexpCols","regexpReviewflowCol","parseOptions","content","defaultConfig","reduce","acc","exec","parseBody","description","reviewFlowCol","reviewflowContent","ending","reviewFlowColMatch","reviewflowContentCol","reviewflowContentColPrefix","reviewflowContentColSuffix","hasFailedStatusOrChecks","context","repoContext","pr","checks","github","listForRef","repo","ref","head","sha","per_page","failedChecks","data","check_runs","filter","check","conclusion","length","log","info","id","combinedStatus","repos","getCombinedStatusForRef","state","failedStatuses","statuses","autoMergeIfPossible","payload","pull_request","prLabels","autoMergeLabel","createMergeLockPrFromPr","number","branch","find","l","debug","prId","prNumber","removePrFromAutomergeQueue","hasNeedsReview","hasRequestedReview","lockedPr","getMergeLockedPr","pushAutomergeQueue","addMergeLockPr","mergeable","undefined","prResult","pulls","get","pull_number","merged","mergeable_state","reschedule","startsWith","issues","update","body","replace","base","merge","owner","login","parsedBody","mergeResult","merge_method","commit_title","commit_message","Boolean","err","message","initRepoLabels","listLabelsForRepo","finalLabels","labelKey","labelConfig","Object","entries","labelColor","slice","existingLabel","result","createLabel","current_name","updateLabel","getKeys","o","keys","ExcludesFalsy","initTeamSlack","mention","postMessage","Promise","resolve","githubLoginToSlackEmail","groupName","assign","slackClient","WebClient","allUsers","users","limit","members","values","email","member","user","profile","console","warn","im","open","channel","membersMap","Map","getUserFromGithubLogin","githubLogin","text","DRY_RUN","chat","initTeamContext","slackPromise","githubLoginToGroup","forEach","set","githubLoginToTeams","teamName","push","getReviewerGroups","githubLogins","Set","getReviewerGroup","getTeamsForLogin","reviewShouldWait","reviewerGroup","requestedReviewers","includesReviewerGroup","includesWaitForGroups","requestedReviewerGroups","request","includes","some","group","slack","orgContextsPromise","orgContexts","obtainOrgContext","repository","existingTeamContext","existingPromise","promise","then","orgContext","delete","initRepoContext","create","all","reviewGroupNames","needsReviewLabelIds","key","requestedReviewLabelIds","changesRequestedLabelIds","approvedReviewLabelIds","protectedLabelIds","labelIdToGroupName","reviewGroupLabels","lock","Lock","lockMergePr","automergeQueue","lockPROrPRS","prIdOrIds","callback","reject","createReleaseCallback","release","Error","setTimeout","String","hasChangesRequestedReview","hasApprovesReview","getNeedsReviewGroupNames","shift","value","p","repoContextsPromise","repoContexts","obtainRepoContext","NAME","existingRepoContext","handlerPullRequestChange","createHandlerPullRequestChange","createHandlerPullRequestsChange","getPullRequests","prs","autoAssignPRToCreator","assignees","type","addAssignees","cleanTitle","trim","s","arg1","toLowerCase","toMarkdownOptions","join","toMarkdownInfos","infos","updateBody","updateOptions","parsed","infosParagraph","updatedOptions","editOpenedPR","skipAutoMerge","isPrFromBot","errorRule","rule","date","Date","toISOString","hasLintPrCheck","createStatus","target_url","head_sha","started_at","completed_at","output","featureBranchLabel","automergeLabel","prHasFeatureBranchLabel","prHasAutoMergeLabel","defaultOptions","hasDiffInTitle","hasDiffInBody","removeLabel","addLabels","addStatusCheck","hasPrCheck","created_at","createFailedStatusCheck","updateStatusCheckFromLabels","requested_reviewers","rr","needsReviewGroupNames","updateReviewStatus","reviewGroup","add","labelsToAdd","remove","labelsToRemove","newLabelNames","toAdd","toDelete","getLabelFromKey","reviewConfig","prLabel","existing","team","newLabelNamesArray","oldLabels","size","replaceLabels","autoApproveAndAutoMerge","codeApprovedLabel","createReview","event","opened","app","on","fromRenovate","closed","git","deleteRef","catch","reviewRequested","sender","reviewer","requested_reviewer","reviews","listReviews","hasChangesRequestedInReviews","html_url","reviewRequestRemoved","hasRequestedReviewsForGroup","hasApprovedInReviews","reviewSubmitted","newLabels","prUrl","reviewDismissed","synchronize","edited","updatePrBody","prBody","labelsChanged","action","checkrunCompleted","check_run","pull_requests","checksuiteCompleted","check_suite","isSameBranch","branches","b","Probot","run","openedHandler","closedHandler","reviewRequestedHandler","reviewRequestRemovedHandler","reviewSubmittedHandler","reviewDismissedHandler","synchromizeHandler","editedHandler"],"mappings":"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"}